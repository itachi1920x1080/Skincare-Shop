{% extends "base.html" %}

{% block title %}Chat with Us - Darling Skincare{% endblock %}

{% block content %}
<div class="chat-page-container">
    <div class="chat-window">
        <div class="chat-header">
            <div class="chat-title">
                <i class="fas fa-robot"></i> Darling Assistant
            </div>
        </div>

        <div class="chat-body" id="chatBody">
            <div class="message bot-message">
                áŸá½áŸáŸ’áá¸! ğŸ‘‹ áá¾á˜á¶á“á¢áŸ’áœá¸á±áŸ’á™ááŸ’á‰á»áŸ†á‡á½á™á‘á¶á€áŸ‹á‘á„á“á¹á„á•á›á·áá•á› Skincare á‘áŸ?
            </div>
            <div class="quick-replies">
                <button onclick="sendQuickReply('show product')">ğŸ›ï¸ á˜á¾á›á•á›á·áá•á›</button>
                <button onclick="sendQuickReply('price')">ğŸ’² áá˜áŸ’á›áŸƒá”áŸ‰á»á“áŸ’á˜á¶á“?</button>
                <button onclick="sendQuickReply('location')">ğŸ“ á‘á¸áá¶áŸ†á„á“áŸ…á¯áá¶?</button>
                <button onclick="sendQuickReply('delivery')">ğŸšš áŸáŸáœá¶áŠá¹á€á‡á‰áŸ’á‡á¼á“</button>
                <button onclick="sendQuickReply('contact')">ğŸ“ á‘á¶á€áŸ‹á‘á„á™á¾á„</button>
                <button onclick="sendQuickReply('about')">ğŸ™‹ á¢áŸ†á–á¸ Darling Skincare</button>
                <button onclick="sendQuickReply('privacy')">ğŸ”’ á¯á€á‡á“á—á¶á–</button>
                <button onclick="sendQuickReply('terms')">ğŸ“œ á›á€áŸ’ááááŸ’áŒ</button>
                <button onclick="sendQuickReply('cancel')">ğŸš« á”áŸ„áŸ‡á”á„áŸ‹á€á¶ášá€á»á˜áŸ’á˜áŸ‰á„áŸ‹</button>
                <button onclick="sendQuickReply('partner')">ğŸ¤ áŠáŸƒá‚á¼áŠá¹á€á‡á‰áŸ’á‡á¼á“</button>
                <button onclick="sendQuickReply('website')">ğŸŒ Website</button>
            </div>
        </div>
        <a ></a>
        <div class="chat-footer">
            <input type="text" id="chatInput" placeholder="áŸášáŸáŸášáŸá¶áš..." onkeypress="handleEnter(event)">
            <button onclick="sendMessage()">
                <i class="fas fa-paper-plane"></i>
            </button>
        </div>
    </div>
</div>

<style>
    /* Layout á–áŸá‰á¢áŸá€áŸ’ášá„áŸ‹ */
    .chat-page-container {
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 80vh; 
        background-color: #f4f4f4;
        padding: 20px;
    }

    /* á”áŸ’ášá¢á”áŸ‹ Chat */
    .chat-window {
        width: 100%;
        max-width: 600px; /* áŠá¶á€áŸ‹á’áŸ†á”á“áŸ’áá·á…á±áŸ’á™áŸá˜á“á¹á„á¢áŸá€áŸ’ášá„áŸ‹ */
        height: 650px;
        background: white;
        border-radius: 15px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        display: flex;
        flex-direction: column;
        overflow: hidden;
    }

    .chat-header { 
        background: #6a0dad; 
        color: white; 
        padding: 20px; 
        font-size: 1.2rem; 
        font-weight: bold; 
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .chat-body { 
        flex: 1; 
        padding: 20px; 
        overflow-y: auto; 
        background: #f8f9fa; 
        display: flex; 
        flex-direction: column; 
        gap: 15px; 
    }

    .message { 
        max-width: 75%; 
        padding: 12px 18px; 
        border-radius: 20px; 
        line-height: 1.5; 
        word-wrap: break-word;
    }

    .bot-message { 
        background: #e9ecef; 
        color: #333; 
        align-self: flex-start; 
        border-bottom-left-radius: 5px; 
    }

    .user-message { 
        background: #6a0dad; 
        color: white; 
        align-self: flex-end; 
        border-bottom-right-radius: 5px; 
    }

    .chat-footer { 
        padding: 15px; 
        border-top: 1px solid #eee; 
        display: flex; 
        gap: 10px; 
        background: white; 
    }

    .chat-footer input { 
        flex: 1; 
        border: 1px solid #ddd; 
        border-radius: 25px; 
        padding: 12px 20px; 
        outline: none; 
        font-size: 1rem;
    }

    .chat-footer button { 
        background: #6a0dad; 
        color: white; 
        border: none; 
        width: 45px; 
        height: 45px; 
        border-radius: 50%; 
        cursor: pointer; 
        transition: 0.2s; 
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .chat-footer button:hover {
        background: #580b94;
    }

    .typing { 
        font-style: italic; 
        color: #888; 
        margin-left: 20px; 
        margin-bottom: 10px; 
        font-size: 0.9rem; 
    }
</style>

<script>
    function handleEnter(event) { 
        if (event.key === "Enter") {
            sendMessage();
        }
    }

    function sendMessage() {
        let inputField = document.getElementById("chatInput");
        let message = inputField.value.trim();
        if (message === "") return;

        // 1. á”á„áŸ’á á¶á‰áŸá¶áš User
        addMessage(message, "user");
        inputField.value = "";

        // 2. á”á„áŸ’á á¶á‰áŸá‰áŸ’á‰á¶ Typing...
        let chatBody = document.getElementById("chatBody");
        let loadingDiv = document.createElement("div");
        loadingDiv.className = "typing";
        loadingDiv.id = "typingIndicator";
        loadingDiv.innerText = "Darling is typing...";
        chatBody.appendChild(loadingDiv);
        chatBody.scrollTop = chatBody.scrollHeight;

        // 3. á áŸ…á‘áŸ… Python (Fetch API)
        fetch('/get_bot_response', {
            method: 'POST',
            body: JSON.stringify({ msg: message }),
            headers: { 'Content-Type': 'application/json' }
        })
        .then(response => response.json())
        .then(data => {
            // á›á»á”áŸá‰áŸ’á‰á¶ Typing á…áŸá‰
            let loader = document.getElementById("typingIndicator");
            if(loader) loader.remove();
            
            // á”á„áŸ’á á¶á‰áŸá¶áš Bot
            addMessage(data.response, "bot");
        })
        .catch(error => {
            let loader = document.getElementById("typingIndicator");
            if(loader) loader.remove();
            addMessage("áŸá¼á˜á¢á—áŸá™á‘áŸ„áŸ á˜á¶á“á”á‰áŸ’á á¶á”á…áŸ’á…áŸá€á‘áŸáŸáŸ”", "bot");
            console.error(error);
        });
    }

    function addMessage(text, sender) {
        let chatBody = document.getElementById("chatBody");
        let div = document.createElement("div");
        div.classList.add("message");
        div.classList.add(sender === "user" ? "user-message" : "bot-message");
        div.innerText = text;
        chatBody.appendChild(div);
        
        // Scroll á…á»áŸ‡á€áŸ’ášáŸ„á˜
        chatBody.scrollTop = chatBody.scrollHeight;
    }
    // Function áŸá˜áŸ’ášá¶á”áŸ‹á–áŸá›á…á»á…á›á¾á”áŸŠá¼áá»á„áŸáŸ†áá½áš
function sendQuickReply(text) {
    // áŸ¡. áŠá¶á€áŸ‹á¢á€áŸ’áŸášá…á¼á›á€áŸ’á“á»á„á”áŸ’ášá¢á”áŸ‹ Input
    document.getElementById("chatInput").value = text;
    
    // áŸ¢. á áŸ… Function á•áŸ’á‰á¾áŸá¶ášááŸ‚á˜áŸ’áá„
    sendMessage();
}
</script>
{% endblock %}